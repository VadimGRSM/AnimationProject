{% extends 'animation/base.html' %}
{% load static %}

{% block title %}Редактор проекта {{ project.title }}{% endblock %}

{% block content %}
<div class="editor-root"
     data-project-id="{{ project.id }}"
     data-project-width="{{ project.width }}"
     data-project-height="{{ project.height }}"
     data-project-save-url="{% url 'animation:project_save' project.pk %}"
     data-frames-list-url="{% url 'animation:frames_list' project.pk %}"
     data-frame-detail-url-template="{% url 'animation:frame_detail' project.pk 0 %}"
     data-frame-create-url="{% url 'animation:frame_create' project.pk %}"
     data-frame-delete-url-template="{% url 'animation:frame_delete' project.pk 0 %}"
     data-frame-reorder-url="{% url 'animation:frame_reorder' project.pk %}"
     data-frame-save-url-template="{% url 'animation:frame_save' project.pk 0 %}"
     data-layer-list-url-template="{% url 'animation:frame_layers' project.pk 0 %}"
     data-layer-reorder-url-template="{% url 'animation:layer_reorder' project.pk 0 %}"
     data-layer-update-url-template="{% url 'animation:layer_update' project.pk 0 0 %}"
     data-layer-delete-url-template="{% url 'animation:layer_delete' project.pk 0 0 %}"
     data-icon-rename="{% static 'animation/icons/edit-layer.svg' %}"
     data-icon-eye-open="{% static 'animation/icons/eye-open.svg' %}"
     data-icon-eye-closed="{% static 'animation/icons/eye-closed.svg' %}"
     data-icon-trash="{% static 'animation/icons/trash.svg' %}"
     data-icon-plus="{% static 'animation/icons/plus.svg' %}"
     data-current-frame-preview-url="{{ current_frame_preview_url }}"
     data-current-frame-updated-at="{{ current_frame_updated_at }}"
     data-current-frame-index="{{ current_frame_index }}">

    <div class="editor-header">
        <div class="editor-title">
            <span class="save-indicator save-indicator--idle"
                  id="save-indicator"
                  aria-hidden="true"></span>
            <h2 class="editor-project-title">{{ project.title }}</h2>
        </div>
        <div class="editor-save">
            <button type="button"
                    id="save-project-button"
                    class="tool-button"
                    disabled>
                Сохранить проект
            </button>
            <span class="save-status" id="save-status" aria-live="polite">
                Нет изменений
            </span>
            <span class="save-last-time" id="last-saved-time"></span>
        </div>
    </div>

    <div class="editor-toolbar">
        <button type="button"
                class="tool-button tool-button--active"
                data-tool="brush"
                aria-label="Кисть">
            <img class="tool-icon" src="{% static 'animation/icons/brush.svg' %}" alt="">
        </button>

        <button type="button"
                class="tool-button"
                data-tool="eraser"
                aria-label="Ластик">
            <img class="tool-icon" src="{% static 'animation/icons/eraser.svg' %}" alt="">
        </button>

        <button type="button"
                class="tool-button"
                data-tool="fill"
                aria-label="Заливка">
            <img class="tool-icon" src="{% static 'animation/icons/fill.svg' %}" alt="">
        </button>

        <button type="button"
                class="tool-button"
                data-tool="eyedropper"
                aria-label="Пипетка">
            <img class="tool-icon" src="{% static 'animation/icons/eyedropper.svg' %}" alt="">
        </button>

        <button type="button"
                class="tool-button"
                data-tool="line"
                aria-label="Линия">
            <img class="tool-icon" src="{% static 'animation/icons/line.svg' %}" alt="">
        </button>

        <button type="button"
                class="tool-button"
                data-tool="rectangle"
                aria-label="Прямоугольник">
            <img class="tool-icon" src="{% static 'animation/icons/rectangle.svg' %}" alt="">
        </button>

        <button type="button"
                class="tool-button"
                data-tool="ellipse"
                aria-label="Окружность">
            <img class="tool-icon" src="{% static 'animation/icons/ellipse.svg' %}" alt="">
        </button>

        <button type="button"
                class="tool-button"
                data-tool="pan"
                aria-label="Панорама">
            <img class="tool-icon" src="{% static 'animation/icons/hand.svg' %}" alt="">
        </button>

        <button type="button"
                class="tool-button"
                data-tool="select"
                aria-label="Выделение">
            <img class="tool-icon" src="{% static 'animation/icons/lasso.svg' %}" alt="">
        </button>

        <div class="tool-control tool-control--group">
            <span class="tool-control__label">Режим выделения</span>
            <button type="button"
                    class="tool-button tool-button--mode tool-button--active"
                    data-select-mode="rect"
                    aria-label="Выделение прямоугольником">
                <img class="tool-icon" src="{% static 'animation/icons/select-rect.svg' %}" alt="">
            </button>
            <button type="button"
                    class="tool-button tool-button--mode"
                    data-select-mode="ellipse"
                    aria-label="Выделение окружностью">
                <img class="tool-icon" src="{% static 'animation/icons/select-ellipse.svg' %}" alt="">
            </button>
            <button type="button"
                    class="tool-button tool-button--mode"
                    data-select-mode="lasso"
                    aria-label="Выделение лассо">
                <img class="tool-icon" src="{% static 'animation/icons/lasso.svg' %}" alt="">
            </button>
            <button type="button"
                    class="tool-button tool-button--mode"
                    data-select-mode="magic"
                    aria-label="Волшебная палочка">
                <img class="tool-icon" src="{% static 'animation/icons/wand.svg' %}" alt="">
            </button>
        </div>

        <label class="tool-control tool-control--wand">
            Чувствительность
            <input type="range"
                   id="wand-sensitivity"
                   min="0"
                   max="255"
                   value="32">
        </label>

        <label class="tool-control">
            Цвет
            <input type="color"
                   id="color-picker"
                   value="#000000">
        </label>

        <label class="tool-control">
            Размер
            <input type="range"
                   id="brush-size"
                   min="1"
                   max="50"
                   value="4">
        </label>
    </div>

    <div class="editor-main">
        <div class="canvas-wrapper">
            <canvas id="editor-canvas"
                    width="{{ project.width }}"
                    height="{{ project.height }}">
            </canvas>
            <canvas id="editor-overlay"
                    width="{{ project.width }}"
                    height="{{ project.height }}"
                    aria-hidden="true">
            </canvas>
            <div class="eyedropper-zoom" id="eyedropper-zoom" aria-hidden="true">
                <canvas id="eyedropper-zoom-canvas" width="120" height="120"></canvas>
            </div>

            <aside class="layers-panel" aria-label="Слои">
                <div class="layers-panel__header">
                    <h3 class="layers-panel__title">Слои</h3>
                    <button type="button"
                            class="tool-button tool-button--small layers-panel__add"
                            id="add-layer-button"
                            aria-label="Добавить слой"
                            title="Добавить слой">
                        <img class="tool-icon tool-icon--small"
                             src="{% static 'animation/icons/plus.svg' %}"
                             alt="">
                    </button>
                </div>
                <ul class="layers-list" id="layers-list"></ul>
                <p class="layers-empty" id="layers-empty" hidden>Слои не найдены</p>
            </aside>
        </div>
    </div>

    <div class="timeline-wrapper" aria-label="Таймлайн кадров">
        <div class="timeline-controls">
            <button type="button"
                    class="tool-button tool-button--small"
                    id="add-frame-button"
                    title="Добавить кадр"
                    aria-label="Добавить кадр">
                +
            </button>
            <button type="button"
                    class="tool-button tool-button--small"
                    id="duplicate-frame-button"
                    title="Дублировать кадр"
                    aria-label="Дублировать кадр">
                ⧉
            </button>
            <button type="button"
                    class="tool-button tool-button--small"
                    id="delete-frame-button"
                    title="Удалить кадр"
                    aria-label="Удалить кадр">
                <img class="tool-icon tool-icon--small" src="{% static 'animation/icons/trash.svg' %}" alt="">
            </button>
        </div>
        <div class="timeline-strip" id="timeline-strip" role="list"></div>
    </div>

</div>

{# bootstrap-код и подключение JS #}
<script src="{% static 'animation/editor.js' %}"></script>
{% endblock %}
